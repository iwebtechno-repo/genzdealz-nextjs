<!DOCTYPE html>
<html lang="en" class="position-relative">

<head>
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-PL5GVMRBH9"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());

    gtag('config', 'G-PL5GVMRBH9');
  </script>

  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-DS58BG5N5D">
  </script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());

    gtag('config', 'G-DS58BG5N5D');
  </script>

  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
  <meta name="description"
    content="Unlock premium savings with Life Vitae at GenZDealZ.ai! Explore exclusive discounts on subscriptions, memberships, and more. Elevate your lifestyle while saving big. Don't miss out – grab your Life Vitae deal today!" />
  <meta name="author" content="" />
  <link rel="icon" href="https://genzdealz.ai/icons/logo_white_old.jpg" />

  <title>GenZDealZ.ai | SmarTab : Deal Chahta Hai!? Your AI-based Student Discovery App</title>

  <meta name="twitter:card" content="GenZDealZ.ai_large_image" />
  <meta name="twitter:image" content="https://genzdealz.ai/icons/logo_white_old.jpg" />
  <!-- Other meta tags -->
  <meta property="og:title"
    content="GenZDealZ.ai | Life Vitae : Deal Chahta Hai!? Your AI-based Student Discovery App" />
  <meta property="og:description"
    content="Unlock premium savings with Life Vitae at GenZDealZ.ai! Explore exclusive discounts on subscriptions, memberships, and more. Elevate your lifestyle while saving big. Don't miss out – grab your Life Vitae deal today!" />
  <meta property="og:image" content="https://genzdealz.ai/icons/logo_white_old.jpg" />
  <meta property="og:url" content="https://genzdealz.ai/" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Rubik:ital,wght@0,300..900;1,300..900&display=swap"
    rel="stylesheet">
  <!-- Bootstrap core CSS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/css/bootstrap.min.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css">

  <!-- Place your stylesheet here-->
  <!-- <script type="text/javascript" language="javascript">
    var versionUpdate = (new Date()).getTime();
    var link = document.createElement("link");
    link.href = "./css/style_new.css?v=" + versionUpdate;
    link.rel = "stylesheet"
    link.type = "text/css"
    document.head.appendChild(link);  
  </script> -->
  <link href="./css/style_new.css?v=1.1" rel="stylesheet" type="text/css" />
  <link href="./css/3D_card.css" rel="stylesheet" type="text/css" />
  <script src="https://sdk.cashfree.com/js/v3/cashfree.js"></script>
  <style>
    .otp-field {
      display: flex;
    }

    .otp-field input {
      letter-spacing: 9px;
      white-space: nowrap;
      width: 100%;
      min-width: 150px;
      height: fit-content;
      font-size: 20px;
      /* padding: 10px; */
      /* text-align: center; */
      /* border-radius: 5px; */
      margin: 5px;
      border: transparent;
      border-bottom: 2px solid #FFFFFF;
      background: transparent;
      font-weight: bold;
      color: #fff;
      outline: none;
      transition: all 0.1s;
    }
  </style>
</head>

<body class="">

  <special-header></special-header>

  <div class="margin" style="margin-bottom: 125px"><span></span></div>
  <div class="wrapper container-lg px-0">
    <div class="row justify-content-center mx-0">
      <div class="col-12 col-md-9 col-lg-12 px-0">
        <h1 class="text-white">NISM Series Research Analyst</h1>
      </div>
      <div class="col-md-6 my-4">
        <div class="">
          <img src="https://unidealz.in/images/prof_sheetal_kunder_academy.png" alt="LifeVitae"
            class="img-fluid rounded-4 shadow">
        </div>
      </div>
      <div class="col-12 mt-3">
        <h2 class="text-white">NISM Series Research Analyst, A COURSE WITH 120 DAYS VALIDITY</h2>
      </div>
      <div class="col-12 mt-3">
        <div class="d-flex">
          <p class="text-white ms-2 position-relative fs-5" style="text-align: justify;">
            ➜ This course is designed to provide you with a thorough understanding of the NISM Series XV Research
            Analyst Certification exam, offering comprehensive coverage of all essential topics. Whether you're aiming
            to become a research analyst or enhance your skills in the financial industry, this course equips you with
            the knowledge and insights necessary to excel. With in-depth explanations and practical examples, you'll
            gain the expertise needed to succeed in analyzing financial markets, evaluating investment opportunities,
            and making informed decisions.</p>
        </div>
      </div>
      <div class="col-lg-6 text-white">
        <div class=" text-start">
          <h5>➤ Key Highlights:</h5>
          <p class="mb-0">⇢ Fundamental and technical analysis</p>
          <p>⇢ Industry research</p>
        </div>
        <div class=" text-start">
          <h5>➤ What you will learn:</h5>
          <p class="mb-0 fw-bold">✦ Enhanced Analytical Skills</p>
          <p>⇢ Develop a deep understanding of fundamental and technical analysis techniques to make informed investment
            decisions.</p>
          <p class="mb-0 fw-bold">✦ Industry Insights</p>
          <p>⇢ Acquire insights into various industries to identify trends, opportunities, and risks affecting companies
            within those sectors.</p>
        </div>
        <div class=" text-start">
          <h6>➤ With interactive chapter-wise recorded lectures, you get access to Prof. Sheetal Kunder daily from 5 to
            7 PM (except Sundays) to clear your doubts..</h6>
        </div>
      </div>
      <div class="col-lg-6 text-white">
        <div class="text-start">
          <h5 class="custom-list-icon d-flex"><span><i class="fa fa-check-circle me-2"
                style="color: gold;"></i>Structured NISM Mentorship</h5>
          <p class="custom-list-icon d-flex">⦿ Our curriculum is designed with the latest NISM updates and 100%
            exam-oriented questions to clear in 1st attempt..</p>
          <h5 class="custom-list-icon d-flex"><span><i class="fa fa-check-circle me-2" style="color: gold;"></i>NISM
              Professionals Community</h5>
          <p class="custom-list-icon d-flex">⦿ Interact and network with NISM professionals, SEBI registered members and
            finance firm executives for any exam/finance career query..</p>
          <h5 class="custom-list-icon d-flex"><span><i class="fa fa-check-circle me-2" style="color: gold;"></i>Learn
              with PSKA Alumni</h5>
          <p class="custom-list-icon d-flex">⦿ Stuck on something? Discuss it with PSKA alumni (who are CA, CA inter,
            finance executives, SEBI registered members, consulting firm owners, etc.).</p>
          <h5 class="custom-list-icon d-flex"><span><i class="fa fa-check-circle me-2" style="color: gold;"></i>Massive
              Practice of Mock Test</h5>
          <p class="custom-list-icon d-flex">⦿ With hundreds of MCQs designed to ensure students get above 90% in our
            MCQs that'll help them gain 100% confidence in booking the exam slot..</p>
          <h5 class="custom-list-icon d-flex"><span><i class="fa fa-check-circle me-2" style="color: gold;"></i>Get
              Certified From <abbr class="text-white"> SEBI&reg</abbr> Research Analyst</h5>
          <p class="custom-list-icon d-flex">⦿ With NISM certification you get certification from Prof. Sheetal Kunder
            who's SEBI registered member (advantageous for any finance career)</p>

        </div>
      </div>
      <div class="col-12">
        <h2 class="text-white mb-4">Start Your NISM XV Prep for Just ₹3000!</h2>
      </div>
      <div class="col-sm-10 col-md-6 mb-4">
        <iframe height="315" src="https://www.youtube.com/embed/8seZPEBUqOg?si=UYRkpHNXZpPZPIfe" class="rounded-5 w-100"
          title="YouTube video player" frameborder="0"
          allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
          referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>
      </div>
      <div class="col-12 mb-5">
        <button class="btn shadow rounded-5 border-0 text-white fw-bold px-3 fs-4 px-5" id="buyLifeVitae"
          style="background: #2e3192;">
          <div class="spinner-border text-white loader d-none mx-auto" style="height: 2.6rem; width: 2.6rem;"
            role="status">
            <span class="visually-hidden">Loading...</span>
          </div><span class="text-buy text-b fw-bold d-block mx-auto">Buy Now</span>
        </button>
      </div>


    </div>


  </div>
  <!-- Bootstrap Toast -->
  <div id="toastContainer" class="position-fixed bottom-0 end-0 p-3" style="z-index: 11;"></div>
  <special-footer></special-footer>
<special-chatbots></special-chatbots>
  <!-- Modal -->
  <div class="modal fade" id="otpModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
    aria-labelledby="otpModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content bg-prim-new">
        <div class="modal-header border-0 justify-content-center">
          <h1 class="modal-title fs-5 text-white" id="otpModalLabel">Please Verify your phone number to proceed!</h1>
        </div>
        <div class="modal-body text-center">
          <p id="eml" class="text-white"></p>
          <div class="d-flex align-items-center w-100 mb-4">
            <span class="text-white">+91|</span>
            <div class="form-floating w-100 ms-2">
              <input type="text" maxlength="10" class="form-control bg-transparent text-white" id="number"
                placeholder="" required="">
              <label for="number" class="text-white">Phone Number </label>
            </div>
          </div>
          <div class="d-flex align-items-center">
            <div class="otp-field w-50 align-items-center" style="display: none;">
              <input id="otpInput" type="text" inputmode="numeric" autocomplete="one-time-code" maxlength="6"
                pattern="\d{6}" required />
            </div>
            <div class="w-50 otp-loader" style="display: none;">
              <div class="spinner-border text-white mx-auto" style="height: 2.5rem; width: 2.5rem;" role="status">
                <span class="visually-hidden">Loading...</span>
              </div>

            </div>

            <div class="">
              <i class="fa-solid fa-circle-check text-success otp-success" style="display: none; font-size: 30px;"></i>
              <i class="fa-solid fa-circle-xmark text-danger otp-error" style="display: none; font-size: 30px;"></i>
            </div>
            <div class="ms-auto text-end w-50" style="">
              <button id="sendOtp" class="btn shadow rounded-5 border-0 text-white my-0" disabled
                style="background-color: #0596BA; height: 45px;">Send OTP</button>
            </div>
          </div>
          <div class="d-flex w-100 justify-content-center">
            <p class="error-text text-danger mt-2"></p>
          </div>
          <div id="recaptcha-container"></div>
          <!-- <input type="text" id="verificationCodeInput" placeholder="Enter verification code">/ -->
          <button id="verifyOtp" class="btn shadow w-50 rounded-5 border-0 text-white my-3"
            style="background-color: #0596BA; height: 45px; display: none;">Save</button>
        </div>
      </div>
    </div>
  </div>
  


  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.1/jquery.min.js"
    integrity="sha512-aVKKRRi/Q/YV+4mjoKBsE4x3H+BkegoM/em46NNlCqNTmUYADjBbeNefNxYV7giUp0VxICtqdrbqU7iVaeZNXA=="
    crossorigin="anonymous" referrerpolicy="no-referrer"></script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/js/bootstrap.bundle.min.js"></script>
  <script src="./js/headerFooter.js" type="module"></script>


  <script src="./js/firebase_auth.js" type="module"></script>
  <!-- <script src="./js/initialize.js?v=1.1" type="module"></script> -->
  <script src="./js/dynamic_dropdown.js?v=1.1" type="module"></script>

  <script src="./js/3D_card.js"></script>
  <script src="./js/chatgpt.js"></script>
  <script>


    if (localStorage.getItem('authenticated') === 'true') {


    } else {
      // User is not authenticated, redirect to the login page or handle accordingly
      window.location.href = 'login';
    }


    $(document).ready(function () {
      $("#overlay").hide();
      $(".footer").show();
    });
  </script>
  <script type="module">
    // Common Firebase initialization and functions section //////-------
    import {
      auth, db,
      signInWithPhoneNumber,
      RecaptchaVerifier,
      getDoc,
      doc,
      setDoc,
    } from "/js/firebase_auth.js";
    const userId = localStorage.getItem("userId");
    localStorage.removeItem("transactionData");
    if (!userId) {
      console.error("userId not found in localStorage.");
      // Handle the error, e.g., redirect to login or show an error message
    } else {
      const userDocRef = doc(db, "usersCollection", userId);
      const userDocSnapshot = await getDoc(userDocRef);

      if (userDocSnapshot.exists()) {
        const userData = userDocSnapshot.data();
        localStorage.setItem("userDataF", JSON.stringify(userData));
        // Retrieve the userDataF from localStorage
        let userDataF = JSON.parse(localStorage.getItem("userDataF"));
        // console.log(userDataF);
        // Check if userDataF exists in localStorage
        if (userDataF) {
          // Update the phone number and phone verification status
          userDataF.phoneNumber = userData.phoneNumber;
          userDataF.phoneVerified = userData.phoneVerified; // or false, depending on the verification status

          // Store the updated userDataF back into localStorage
          localStorage.setItem("userDataF", JSON.stringify(userDataF));
          // $("#otpModal").modal("hide");
          // proceed();
        } else {
          console.error("userDataF not found in localStorage.");
        }
        //debugger
      }
    }

    // Cashfree mode section ///////------------
    let cashfree = Cashfree({
      mode: "production",
      // mode: "sandbox",
    });

    let buyLifeVitae = document.getElementById("buyLifeVitae");
    buyLifeVitae.addEventListener("click", handlePayment);

    // Helper to display toast messages
    const toastContainer = document.getElementById("toastContainer");
    function showToast(message, isError = false) {
      const toast = document.createElement("div");
      toast.className = `toast align-items-center text-bg-${isError ? "danger" : "success"} border-0`;
      toast.role = "alert";
      toast.innerHTML = `
<div class="d-flex">
  <div class="toast-body">${message}</div>
  <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
</div>
`;
      toastContainer.appendChild(toast);
      const bsToast = new bootstrap.Toast(toast);
      bsToast.show();
      toast.addEventListener("hidden.bs.toast", () => toast.remove());
    }
    // Function to handle recharge logic
    function handlePayment() {

      // console.log("Recharge process started");
      // console.log("Mobile Number Value:", mNumberValue);
      // console.log("selected Operator Discount:", selectedOperatorDiscount);
      // console.log("Selected Circle ID:", selectedCircle);
      // console.log("Selected Circle Name:", selectedCircleName);
      // console.log("Selected Operator Name:", selectedOperatorName);
      // console.log("Selected Operator Image:", selectedOperatorImage);
      // console.log("Mobile Number:", mNumber);
      // console.log("Operator ID:", selectedOperator);
      // console.log("Plan ID:", planId);
      // console.log("Price:", price);
      // console.log("Old Price:", oldPrice);
      // console.log("Data Benefit:", dataBenefit);
      // console.log("Talktime:", talktime);
      // console.log("Validity:", validity);
      // console.log("Description:", escapedDesc.replace(/\n/g, "<br>"));


      const userDataString =
        localStorage.getItem("userDataF");

      if (!userDataString) {
        console.error("User data not available in local storage");
        // Optionally, handle the absence of user data and inform the user
        return false; // Return false to prevent form submission
      }

      // Parse user data from the string
      const userData = JSON.parse(userDataString);


      // State mapping section //////------
      const stateMapping = {
        "Andaman and Nicobar Islands": "AN",
        "Andhra Pradesh": "AP",
        "Arunachal Pradesh": "AR",
        "Assam": "AS",
        "Bihar": "BR",
        "Chandigarh": "CH",
        "Chhattisgarh": "CT",
        "Dadra and Nagar Haveli": "DN",
        "Daman and Diu": "DD",
        "Delhi": "DL",
        "Goa": "GA",
        "Gujarat": "GJ",
        "Haryana": "HR",
        "Himachal Pradesh": "HP",
        "Jammu and Kashmir": "JK",
        "Jharkhand": "JH",
        "Karnataka": "KA",
        "Kerala": "KL",
        "Ladakh": "LA",
        "Lakshadweep": "LD",
        "Madhya Pradesh": "MP",
        "Maharashtra": "MH",
        "Manipur": "MN",
        "Meghalaya": "ML",
        "Mizoram": "MZ",
        "Nagaland": "NL",
        "Odisha": "OR",
        "Puducherry": "PY",
        "Punjab": "PB",
        "Rajasthan": "RJ",
        "Sikkim": "SK",
        "Tamil Nadu": "TN",
        "Telangana": "TG",
        "Tripura": "TR",
        "Uttar Pradesh": "UP",
        "Uttarakhand": "UK",
        "West Bengal": "WB",
        // Add more state mappings as needed
      };
      let state;
      const stateValue = stateMapping[userData?.state] || userData.state;

      // Check if stateValue is defined and not empty
      if (stateValue && stateValue.length > 2) {
        state = stateValue.split(" ")[1].replace(/\(|\)/g, "");
        // checkUserAuthStatus()
      }

      // Assuming userData is already retrieved from local storage
      const name = userData?.name;
      // Function to extract the first and last words from a string
      function getFirstAndLastWords(fullName) {
        const words = fullName.split(/\s+/);
        const firstWord = words[0] || "DefaultFirst";
        const lastWord = words[words.length - 1] || "DefaultLast";
        return { firstWord, lastWord };
      }

      // Use the chosen userData for first_name and last_name
      const { firstWord, lastWord } = name
        ? getFirstAndLastWords(name)
        : { firstWord: "DefaultFirst", lastWord: "DefaultLast" };

      let gender = (userData?.gender || userData.gender)?.toUpperCase();

      // Conditions to check users phone number is verified or not ////------
      // Check if userData has phoneNumber and verified
      if (userData && userData.phoneNumber && userData.phoneVerified === true) {
        // console.log("User has a phone number and verified:", userData.phoneNumber);
        //debugger
        proceed();
      } else if (userData && userData.phoneNumber) {
        // console.log("User has a phone number but it's not verified.");
        $('#otpModal').modal('show');
        $("#verifyOtp").show();

        const input = document.querySelector("#number");
        input.value = userData.phoneNumber; // Set input value from userData.phoneNumber
        function restrictToNumbers() {
          if (!input) return false; // Exit if input is not found
          input.value = input.value.replace(/\D/g, ""); // Remove any non-numeric characters
          return true; // Validation passed
        }
        input.addEventListener("input", restrictToNumbers);
        //debugger
        sendVerificationCode();
        // You might want to handle this case differently, like prompting the user to verify their phone number again.
      } else {
        // console.log("User does not have a phone number.");
        $('#otpModal').modal('show');
        $("#verifyOtp").show();
        const input = document.querySelector("#number");
        function restrictToNumbers() {
          if (!input) return false; // Exit if input is not found
          input.value = input.value.replace(/\D/g, ""); // Remove any non-numeric characters
          return true; // Validation passed
        }
        input.addEventListener("input", restrictToNumbers);
        //debugger
        sendVerificationCode()
      }

      // Check in firebase mobile verified code section ///////-------
      const verifyOtp = document.querySelector("#verifyOtp");
      async function handleVerification() {
        // Your asynchronous logic here
        const userId = localStorage.getItem("userId");
        const userDocRef = doc(db, "usersCollection", userId);
        const userDocSnapshot = await getDoc(userDocRef);
        setDoc(userDocRef, {
          phoneNumber: number.value,
        }, { merge: true });
        $("#verifyOtp").text("Saving...");
        if (userDocSnapshot.exists()) {
          const userData = userDocSnapshot.data();
          // Retrieve the userDataF from localStorage
          let userDataF = JSON.parse(localStorage.getItem("userDataF"));

          // Check if userDataF exists in localStorage
          if (userDataF) {
            // Update the phone number and phone verification status
            userDataF.phoneNumber = number.value;

            // Store the updated userDataF back into localStorage
            localStorage.setItem("userDataF", JSON.stringify(userDataF));
            setTimeout(function () {
              $("#otpModal").modal("hide");
              // $("#otpModal").modal("hide");
              // window.location.reload();
            }, 2000);
          } else {
            console.error("userDataF not found in localStorage.");
          }
        }

      }
      $("#verifyOtp").text("Save");
      verifyOtp.addEventListener('click', async () => {
        await handleVerification();
      });

      // OTP sending code ////---------
      function sendVerificationCode() {
        setTimeout(function () {
          $(".loader").addClass("d-none");
          $(".loader").removeClass("d-block");
          $(".text-buy").removeClass("d-none");
          $(".text-buy").addClass("d-block");
        }, 1000);
        // const auth = getAuth(app);
        auth.useDeviceLanguage();
        // Set app verification disabled for testing
        // auth.settings.appVerificationDisabledForTesting = true;
        const sendOtpFunc = async () => {
          try {
            const sendOtp = document.querySelector("#sendOtp");
            sendOtp.setAttribute("disabled", "disabled");
            $(".otp-loader").show();
            const input = document.querySelector("#number").value;
            // If phone number is not registered, send OTP using Firebase phone authentication
            let number = input
            function getPhoneNumberFromUserInput() {
              // retrieve the phone number from your HTML input element
              return "+91" + number;
            }
            const phoneNumber = getPhoneNumberFromUserInput();

            // Check if phoneNumber is valid
            if (!phoneNumber) {
              console.error("Invalid phone number");
              showToast("Invalid phone number", true);
              $(".toast").toast('show');
              $(".toast-msg").text("Invalid phone number");
              return;
            }
            // recaptcha code /////
            function recaptchaVerifierFunc() {
              // Create a RecaptchaVerifier object with invisible size
              window.recaptchaVerifier = new RecaptchaVerifier(auth, 'recaptcha-container', {
                'size': 'invisible',
                'callback': (response) => {
                  // reCAPTCHA solved, allow signInWithPhoneNumber.
                  // handleSignInWithPhoneNumber()
                },
                'expired-callback': () => {
                  showToast("Verification code is expired", true);
                  $(".toast").toast('show');
                  $(".toast-msg").text("Verification code is expired");
                  recaptchaVerifierFunc()
                  return
                  // Reinitialize reCAPTCHA
                  // initializeRecaptcha();
                }

              });
            }
            recaptchaVerifierFunc();
            try {
              // Request Firebase to send verification code to user's phone
              const confirmationResult = await signInWithPhoneNumber(auth, phoneNumber, window.recaptchaVerifier);
              // Handle error while sending OTP
              $(".otp-field").show();

              $(".otp-loader").hide();
              showToast("Verification code sent successfully!", false);
              $(".toast").toast('show');
              $(".toast-msg").text("Verification code sent successfully!");

              const otpInput = document.getElementById('otpInput');
              otpInput.addEventListener('input', function () {
                if (this.value.length === 6) {
                  submit();
                } else {
                  $(".otp-success").hide();
                  $(".otp-error").hide();
                  $(".error-text").text("")
                }
              });

              otpInput.addEventListener('keypress', function (event) {
                $(".otp-success").hide();
                $(".otp-error").hide();
                $(".error-text").text("")
                if (event.key && !/\d/.test(event.key)) {

                  event.preventDefault();
                }
              });
              let otp;
              function submit() {
                otp = otpInput.value;
                $(".otp-loader").show();
                // $(".otp-field").hide();
                $(".otp-success").hide();
                $(".otp-error").hide();
                $(".error-text").text("")
                handleVerification()
              }
              // Set up event listener to confirm the code when the button is clicked
              async function handleVerification() {
                // submit()
                try {
                  const verificationCodeInput = otp;
                  let confirmationSuccess = false;
                  // Confirm the verification code
                  await confirmationResult.confirm(verificationCodeInput);
                  // The verification code is confirmed successfully
                  confirmationSuccess = true;
                  showToast("Verification code confirmed successfully!", false);
                  $(".toast").toast('show');
                  $(".toast-msg").text("Verification code confirmed successfully!");

                  if (confirmationSuccess) {
                    $("#sendOtp").text("Verified").prop('disabled', true);
                    $(".otp-loader").hide();
                    $(".otp-field").show();
                    $(".otp-success").show();
                    $(".otp-error").hide();
                    $(".error-text").text("")

                    // update in firebase user data //////--------
                    async function updateUserData() {
                      const userId = localStorage.getItem("userId");
                      const userDocRef = doc(db, "usersCollection", userId);
                      const userDocSnapshot = await getDoc(userDocRef);
                      try {
                        // Update Firestore document
                        await setDoc(userDocRef, {
                          phoneNumber: number,
                          phoneVerified: true,
                        }, { merge: true });

                        // Check if the document exists
                        if (userDocSnapshot.exists()) {
                          const userData = userDocSnapshot.data();
                          // Retrieve the userDataF from localStorage
                          let userDataF = JSON.parse(localStorage.getItem("userDataF"));

                          // Check if userDataF exists in localStorage
                          if (userDataF) {
                            // Update the phone number and phone verification status
                            userDataF.phoneNumber = number;
                            userDataF.phoneVerified = true; // or false, depending on the verification status

                            // Store the updated userDataF back into localStorage
                            localStorage.setItem("userDataF", JSON.stringify(userDataF));
                            $("#otpModal").modal("hide");
                            proceed();
                          } else {
                            console.error("userDataF not found in localStorage.");
                          }
                        } else {
                          console.error("User document does not exist.");
                        }
                      } catch (error) {
                        console.error("Error updating user data:", error);
                      }
                    }
                    // Call the function
                    updateUserData();
                  }
                  // Clear input fields
                  // inputs.forEach((input) => {
                  //   input.value = "";
                  // });
                  // $("#otpModal").modal("hide");
                } catch (error) {
                  if (error == "FirebaseError: Firebase: Error (auth/invalid-verification-code).") {
                    $(".otp-loader").hide();
                    $(".otp-field").show();
                    $(".otp-error").show();
                    $(".otp-success").hide();
                    $(".error-text").text("Invalid OTP. Please enter a valid OTP")
                  }
                  console.error("Error confirming verification code:", error);
                }
              };

            } catch (error) {
              $(".loader").hide();
              $(".text-signup").show();
              console.error(`Error sending verification code: ${error}`);
              if (error == "TypeError: Cannot read properties of undefined (reading 'verify')") {
                showToast(`OTP sending on ${number}`, false);
                $(".toast").toast('show');
                $(".toast-msg").text(`OTP sending on ${number}`);
                recaptchaVerifierFunc();
              }
              if (error == "Error: reCAPTCHA has already been rendered in this element") {
                //   $(".toast").toast('show');
                // $(".toast-body").text(`reCAPTCHA has already been rendered in this element refreshing the page`);
                setTimeout(function () {
                  // $("#otpModal").modal("hide");
                  recaptchaVerifierFunc();
                  // window.location.reload();
                }, 5000);
              }
              if (error == "FirebaseError: Firebase: Error (auth/too-many-requests).") {
                showToast(`Too many requests Please try again Later.`, true);
                $(".toast").toast('show');
                $(".toast-msg").text(`Too many requests Please try again Later.`);
                $("#otpModal").modal("hide");
                setTimeout(function () {
                  window.location.reload();
                }, 5000);
              }
              // return
            }
            // console.log(window.recaptchaVerifier)
          } catch (error) {
            console.log(error)
          }
        }
        const sendOtp = document.querySelector("#sendOtp");
        sendOtp.removeAttribute("disabled");
        sendOtp.addEventListener('click', sendOtpFunc);
      }


      function proceed() {
        $(".loader").addClass("d-block");
        $(".loader").removeClass("d-none");
        $(".text-buy").removeClass("d-block");
        $(".text-buy").addClass("d-none");


        const userDataString = localStorage.getItem("userDataF");
        if (!userDataString) {
          console.error("User data not available in local storage");
          // Optionally, handle the absence of user data and inform the user
          return Promise.reject("User data not available in local storage");
        }
        const userData = JSON.parse(userDataString);
        let mobileNumber = userData?.number || userData.mobile_no || userData.phoneNumber || number || phoneNumber;
        let fName = userData?.first_name || firstWord;
        let lName = userData?.last_name || lastWord;

        // signup for cashfree gateway //////////---------
        const myHeaders = new Headers();
        myHeaders.append("Content-Type", "application/json");
        // myHeaders.append("Authorization", "Bearer " + authToken);

        const raw = JSON.stringify({
          email: userData?.email || userData.email_id,
          phone: userData?.number || userData.mobile_no || userData.phoneNumber || number,
          first_name: fName,
          last_name: lName,
          gender: gender,
          state: state,
          employee_of: "NA",
          remarks: "Special user",
        });
        const requestOptions = {
          method: "POST",
          headers: myHeaders,
          body: raw,
          redirect: "follow",
        };
        fetch("https://flashweb.iweberp.com/api/genz_user_signup", requestOptions)
          .then(async (result) => {
            // const code = storeData.data.code;

            // API call for generating orderId /////-----
            const response = await fetch(`https://flashweb.iweberp.com/api/gen_order_id?mobile_no=${mobileNumber}`);
            if (!response.ok) {
              throw new Error(`HTTP error! Status: ${response.status}`);
            }
            return await response.json();
          })
          .then(async (data) => {
            const orderId = `order_id_NISM_web_${Date.now()}`;
            // console.log("Order ID:", orderId);
            // const orderId = data.order_id;
            const baseURL = window.location.origin;

            function replaceSpacesWithUnderscores(str) {
              return str.replace(/ /g, "_");
            }

            // Cashfree order API /////-----

            const myHeaders = new Headers();

            myHeaders.append("ClientId", "604563f6486ad2386b8aa803bd365406");
            myHeaders.append("ClientSecret", "cfsk_ma_prod_223e71d012e3bdb4a2a0f3a64ba075fe_de980bbc");
            myHeaders.append("Version", "2023-08-01");
            myHeaders.append("Environment", "PRODUCTION");
            myHeaders.append("Content-Type", "application/json");

            // test
            // myHeaders.append("ClientId", "TEST10096276ae5045bc4ef790b12f3a67269001");
            // myHeaders.append("ClientSecret", "cfsk_ma_test_22a935d0421c5ebad9c07ce62b347a03_718bb5d5");
            // myHeaders.append("Version", "2023-08-01");
            // myHeaders.append("Environment", "Sandbox");
            // myHeaders.append("Content-Type", "application/json");


            // (mNumberValue,
            //     selectedCircle,
            //     selectedCircleName,
            //         selectedOperatorName,
            //         selectedOperatorImage,selectedOperatorDiscount, mNumber, selectedOperator, planId, price, oldPrice, dataBenefit, talktime, validity, escapedDesc)
            let mobileNumber = userData?.number || userData.mobile_no || userData.phoneNumber || number || phoneNumber;
            // Encode all parameters
            const urlData = {
              oid: orderId,
              name: fName + " " + lName,
            };
            // console.log(urlData);
            debugger
            // Store data as JSON string in local storage
            localStorage.setItem("transactionData", JSON.stringify(urlData));
            debugger
            // console.log("Uncompressed data stored in local storage.");

            // Generate return_url
            const returnURL = `${baseURL}/transaction_nism`;
            // console.log("Return URL:", returnURL);
            // Check if the URL length is below 500 characters
            if (returnURL.length > 500) {
              console.error("The URL exceeds the 500 character limit!");
              showToast("The URL exceeds the 500 character limit!", true);
            } else {
              // console.log("Return URL:", returnURL);


              // const encodedNumber = encodeURIComponent(mNumberValue);
              // const encodedCircleId = encodeURIComponent(selectedCircle);
              // const encodedCircleName = encodeURIComponent(selectedCircleName);
              // const encodedOperatorName = encodeURIComponent(selectedOperatorName);
              // const encodedOperatorImage = encodeURIComponent(selectedOperatorImage);
              // const encodedOperator = encodeURIComponent(selectedOperator);
              // const encodedPlanId = encodeURIComponent(planId);
              // const encodedOrderId = encodeURIComponent(orderId);
              // const encodedBillAmount = encodeURIComponent(price);
              // const encodedBillAmountOld = encodeURIComponent(oldPrice);
              // const encodedDataBenefit = encodeURIComponent(dataBenefit);
              // const encodedTalktime = encodeURIComponent(talktime);
              // const encodedValidity = encodeURIComponent(validity);
              // const encodedCashback = encodeURIComponent(selectedOperatorDiscount);
              const raw = JSON.stringify({
                "order_id": orderId,
                "customer_id": mobileNumber,
                "customer_phone": mobileNumber,
                "customer_name": fName + " " + lName,
                "customer_email": userData?.email || userData.email_id,
                "order_amount": parseFloat("3030"),
                "order_currency": "INR",
                "return_url": returnURL,
                "notify_url": "https://www.cashfree.com/devstudio/preview/pg/webhooks/29572861"
              });
              // console.log(raw)
              debugger;
              const requestOptions = {
                method: "POST",
                headers: myHeaders,
                body: raw,
                redirect: "follow"
              };
              try {
                const response = await fetch("https://flashweb.iweberp.com/api/create_cashfree_order", requestOptions);

                if (!response.ok) {
                  const errorDetails = await response.json().catch(() => ({})); // Safely parse JSON response
                  const errorMessage = errorDetails?.errorMsg || response.statusText || `HTTP error! Status: ${response.status}`;

                  // Check for specific error messages
                  if (
                    errorMessage.includes("ensure this value is greater than or equal to 1") &&
                    errorMessage.includes("value is not a valid integer")
                  ) {
                    showToast("Discounted amount should be greater than or equal to 1.", true);
                    $(".toast").toast("show");
                    $(".toast-msg").text("Discounted amount should be greater than or equal to 1.");

                    // Reload after a delay
                    setTimeout(function () {
                      window.location.reload();
                    }, 5000);
                  } else {
                    // Throw error for other cases
                    throw new Error(errorMessage);
                  }
                }

                // Return the JSON response for a successful request
                return await response.json();

              } catch (error) {
                console.error("Error occurred:", error.message);
                // Optionally handle other errors here
              }
            }

          })
          .then((responseData) => {
            // google analytics code ----
            // var title = storeData.data.brandName;
            // gtag('event', 'sayf_buy_click_web', {
            //   'sayf_buy_click_web_category': 'Link Click',
            //   'sayf_buy_click_label': `Product Name:${title} ${storeData.data.id}, User Details- ${mobileNumber ? mobileNumber : ""} ${userData.email ? userData.email : ""},Name:${userData.name}`,
            //   'transport_type': 'beacon'
            // });

            // redirect to payment gateway screen 
            let checkoutOptions = {
              paymentSessionId: responseData.payment_session_id,
              redirectTarget: "_self",
            };
            debugger
            cashfree.checkout(checkoutOptions);
            setTimeout(function () {
              $(".loader").removeClass("d-block");
              $(".loader").addClass("d-none");
              $(".text-buy").addClass("d-block");
              $(".text-buy").removeClass("d-none");
            }, 200);
          })
          .catch((error) => {
            console.error("Error:", error);
          });
        return false; // Return false to prevent form submission
      }
      // Add further processing logic here if needed
      showToast("Processing started.", false);
    }
  </script>
</body>

</html>