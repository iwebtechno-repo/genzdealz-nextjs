<!DOCTYPE html>
<html lang="en">

<head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-PL5GVMRBH9"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());

        gtag('config', 'G-PL5GVMRBH9');
    </script>

    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-DS58BG5N5D">
    </script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());

        gtag('config', 'G-DS58BG5N5D');
    </script>
    <meta charset="utf-8" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="language" content="English">
    <meta name="revisit-after" content="1 days">

    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />

    <title>IUMS Students. Unlock Exclusive Deals with GenZDealZ.ai</title>
    <meta name="description"
        content="IUMS students get special benefits. Sign up for GenZDealZ.ai with your IUMS login ID or Enrollment No. and access amazing deals, & personalized recommendations" />
    <meta name="author" content="GenZDealZ.ai">
    <meta name="robots" content="index, follow">
    <meta name="keywords"
        content="AI-based App, Student Discovery App, Deals for Students, Student Coupons, Student Cashbacks, GenZDealZ, Student Discounts, Student Offers, Educational App, Learning App, Student Savings, Scholarship, Lending, Giftcards">


    <link rel="icon" href="https://genzdealz.ai/icons/logo_white_old.jpg" />



    <meta name="twitter:card" content="GenZDealZ.ai_large_image" />
    <meta name="twitter:image" content="https://genzdealz.ai/icons/logo_white_old.jpg" />
    <!-- Other meta tags -->
    <meta property="og:title" content="IUMS Students. Unlock Exclusive Deals with GenZDealZ.ai" />
    <meta property="og:description"
        content="IUMS students get special benefits. Sign up for GenZDealZ.ai with your IUMS login ID or Enrollment No. and access amazing deals, & personalized recommendations" />
    <meta property="og:image" content="https://genzdealz.ai/icons/logo_white_old.jpg" />
    <meta property="og:site_name" content="GenZDealZ.ai" />
    <meta property="og:url" content="https://GenZDealZ.ai" />
    <meta name="target" content="students, college students, university students, high school students" />

    <link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Rubik:ital,wght@0,300..900;1,300..900&display=swap" rel="stylesheet">
    <!-- Bootstrap core CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css">
    <!-- Place your stylesheet here-->
    <!-- <script type="text/javascript" language="javascript">
        var versionUpdate = (new Date()).getTime();
        var link = document.createElement("link");
        link.href = "./css/style_new.css?v=" + versionUpdate;
        link.rel = "stylesheet"
        link.type = "text/css"
        document.head.appendChild(link);  
    </script> -->
    <link href="./css/style_new.css?v=1.1" rel="stylesheet" type="text/css" />
    <style>

        .form-select {
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'%3e%3cpath fill='none' stroke='%23ffffff' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='m2 5 6 6 6-6'/%3e%3c/svg%3e");
        }

        .form-control,
        .form-select {
            color: rgb(255, 255, 255);
            border: 1px solid rgb(213, 213, 213);
        }

        .form-control:focus,
        .form-select:focus {
            border-color: rgb(255, 255, 255);
            outline: 0;
            box-shadow: none;
            color: #FFFFFF;
        }

        .text-danger {
            color: rgb(255 0 24) !important;
        }

        @media (max-width: 576px) {
            #fixed-navbar {
                height: 110px !important;
            }

            .genz-logo {
                height: 100% !important;
                /* width: 100% !important; */
                width: 136px !important;
            }

            .thestorelogos {
                height: 100%;
                width: 70%;
            }

            iframe {
                height: 280px !important;
            }
        }.text-prim, .text-prim:hover {
    color: #00cbff;
}
    </style>
</head>

<body>

    <special-header></special-header>

    <div style="margin-bottom: 125px"><span></span></div>
    <div class="toast-container position-fixed p-3" style="z-index: 1058; top:120px;">
        <div class="toast" class="border-0" class="toast" role="alert" aria-live="assertive" aria-atomic="true"
            data-delay="100">
            <!-- <div class="toast-header">
                <i class="fa fa-skull text-danger fw-bold me-2"></i>
                <strong class="me-auto">Caution</strong>
                <button type="button" class="btn-close" data-bs-dismiss="toast"
                    aria-label="Close"></button>
            </div> -->
            <div class="toast-body">
            </div>
        </div>
    </div>
    <main role="main" class="container mb-3">
        <div class="row justify-content-center align-items-center">

            <div class="col-12 col-md-6 col-lg-5">
                <div class=" text-center rounded p-sm-4 py-2">
                    <h2 class="mb-3 mb-sm-3 text-prim ">IUMS Student?!</h2>
                    <p class="fw-bold h5 mt-2 mb-0 text-white">Directly Sign in with your existing Enrollment No./Email
                        Id & Password</p>


                    <h2 class="mb-3 mb-sm-3 text-prim ">Login</h2>
                    <!-- <div class="notify position-fixed bottom-0 end-0 bg-success rounded-4 px-4 py-2"
                        style="z-index: 10000;"></div> -->
                    <!-- Add this to your HTML file -->
                    <p class="user-status d-none">Checking user status...</p>

                    <!-- <p class="user-status-api">Checking user status...</p> -->
                    <form id="loginForm">
                        <div class="form-floating mb-4 mb-sm-5">
                            <input type="email" class="form-control bg-transparent" id="loginid"
                                placeholder="name@example.com" required="">
                            <label for="loginid" class="text-white-50">Enter your IUMS login ID</label>
                            <div id="emailError" class="error-message"></div>
                        </div>
                        <div class="form-floating mb-2 position-relative">
                            <input type="password" id="password" name="password" required=""
                                class="form-control bg-transparent" placeholder="Password">
                            <label for="password" class="text-white-50">Enter your IUMS login Password</label>
                            <div id="passwordError" class="error-message"></div>
                            <i class="fa fa-eye-slash position-absolute text-white" style="top: 21px; right: 10px;"
                                id="togglePasswordVisibility" onclick="togglePasswordVisibility()"></i>
                        </div>
                    </form>

                    <button type="submit" id="signin" onclick="attemptLogin()"
                        class="btn shadow w-50 rounded-3 border-0 text-white my-3"
                        style="background-color: #2e3192; height: 45px;">
                        <div class="spinner-border text-white loader" style="height: 1.5rem; width: 1.5rem;"
                            role="status">
                            <span class="visually-hidden">Loading...</span>
                        </div><span class="text-signup fw-bold">Sign In</span>
                    </button>

                    <div class="d-flex w-100 justify-content-center align-items-center">
                        <p class="m-0 mx-3 text-white">Already have an account? <a href="login"
                                class="text-prim h5 mb-4 mb-sm-4 d-inline-block">Sign In</a> </p>
                    </div>

                </div>
            </div>
        </div>
    </main>
    <!-- Modal -->
    <div class="modal fade" id="mModal" tabindex="-1" aria-labelledby="mModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content contact-card">
                <div class="modal-header border-0 justify-content-center">
                    <h1 class="modal-title fs-5 text-danger" id="mModalLabel">Email Already in Use</h1>
                </div>
                <div class="modal-body text-center">
                    <p id="eml" class="text-white"></p>
                    <a href="#" class="btn shadow w-75 rounded-3 border-0 text-white mb-3" id="setEmlpss"
                        style="background-color: #2e3192; height: 40px;">
                        <!-- <div class="spinner-border text-white loader"
                        style="height: 1.5rem; width: 1.5rem;" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div> -->
                        <span class="fw-bold">Sign In</span>
                    </a>
                    <a href="./signup" class="btn shadow w-75 rounded-3 border-0 text-white mb-3"
                        id="signUpredirect" style="background-color: #2e3192; height: 40px; display: none;">
                        <!-- <div class="spinner-border text-white loader"
                        style="height: 1.5rem; width: 1.5rem;" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div> -->
                        <span class="fw-bold">Sign Up</span>
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal -->
    <div class="modal fade" id="optInModal" tabindex="-1" aria-labelledby="optInModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content bg-dark">
                <div class="modal-header border-0 text-center justify-content-center">
                    <h1 class="modal-title fs-4 text-white" id="optInModalLabel">Opt-In Request</h1>
                </div>
                <div class="modal-body text-center">
                    <h1 class="modal-title fs-5 text-white">Do you agree to opt-in using your iWeb IUMS credentials?
                    </h1>

                    <div class="d-flex justify-content-around">

                        <div data-bs-dismiss="modal" aria-label="Close"
                            class="btn shadow rounded-4 border-0 text-white my-3 px-4 d-flex m-auto align-items-center"
                            style="background-color: #2e3192; height: 45px;">
                            Yes
                        </div>
                        <a href="./login"
                            class="btn shadow rounded-4 border-0 text-white my-3 px-4 d-flex m-auto align-items-center"
                            style="background-color: #2e3192; height: 45px;">
                            No
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <special-footer></special-footer>



    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.1/jquery.min.js"
        integrity="sha512-aVKKRRi/Q/YV+4mjoKBsE4x3H+BkegoM/em46NNlCqNTmUYADjBbeNefNxYV7giUp0VxICtqdrbqU7iVaeZNXA=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.0.0/crypto-js.min.js"></script>
    <!-- <script type="text/javascript" language="javascript">
        var versionUpdate = (new Date()).getTime();
        var script = document.createElement("script");
        script.type = "text/javascript";
        script.src = "./js/local_deals.js?v=" + versionUpdate;
        document.body.appendChild(script);  
    </script> -->
    <!-- <script src="./js/firebase_auth.js" type="module"></script> -->
    <!-- <script src="./js/signin.js" type="module"></script> -->
    <script type="module">
        $(document).ready(function () {
            $("#overlay").hide();
        });
        import { auth, createUserWithEmailAndPassword, doc, db, setDoc, checkUserAuthStatus } from "/js/firebase_auth.js";
        $(".loader").hide();
        function togglePasswordVisibility() {
            var passwordField = document.getElementById("password");
            var toggleEye = document.getElementById("togglePasswordVisibility");

            if (passwordField.type === "password") {
                passwordField.type = "text";
                toggleEye.className = "fa fa-eye position-absolute text-white"                // toggleButton.textContent = "Hide Password";
            } else {
                passwordField.type = "password";
                toggleEye.className = "fa fa-eye-slash position-absolute text-white"
            }
        }

        if (localStorage.getItem('authenticated') !== 'true') {
            // Set localStorage item to 'true'
            // userStatus.innerHTML = 'User not signed in through API';
            // Optionally, you can set additional items or perform other actions here.
        } else {
            // userStatus.innerHTML = 'User is signed in through API';

        }

        function attemptLogin() {
            $(".loader").show();
            $(".text-signup").hide();
            // Get values from the form
            const loginid = document.getElementById('loginid').value;
            const password = document.getElementById('password').value;
            // Make an AJAX request to the authentication API
            $.ajax({
                url: `https://flashweb.iweberp.com/api/exist_login?loginid=${loginid}&password=${password}`,
                method: 'GET',
                success: function (apiResponse) {
                    if (apiResponse.validate === true) {
                        $(".loader").show();
                        $(".text-signup").hide();
                        // Store authentication information in session storage
                        localStorage.setItem('authenticated', true);
                        // Access and use additional data from the res  ponse
                        var apiRresponse = {
                            email: apiResponse.email_id,
                            first_name: apiResponse.first_name,
                            gender: apiResponse.gender,
                            last_name: apiResponse.last_name,
                            number: apiResponse.mobile_no,
                            state: apiResponse.state_name,
                            name: apiResponse.full_name, // Assuming there's a userName property in the response
                        };
                        // Create an object to hold all the properties
                        var userDataF = {
                            authenticated: true,
                            email: apiResponse.email_id,
                            first_name: apiResponse.first_name,
                            name: apiResponse.full_name,
                            gender: apiResponse.gender,
                            last_name: apiResponse.last_name,
                            number: apiResponse.mobile_no,
                            state: apiResponse.state_name
                        };

                        // Store the object directly in localStorage under a single key
                        localStorage.setItem('userDataF', JSON.stringify(userDataF));

                        // Logic for successful login
                        // $(".toast").toast('show');
                        // $(".toast-header strong").text(`Success`);
                        // $(".toast-header i").removeClass("fa-skull text-danger");
                        // $(".toast-header i").addClass("fa-face-smile-wink text-success");
                        // $(".toast-body").text(`Logged in as ${userDataA.email}.`);
                        // Retrieve the data from localStorage and use it directly
                        var retrievedUserInfo = JSON.parse(localStorage.getItem('userDataF'));
                        // console.log(retrievedUserInfo.email);
                        const email = apiResponse.email_id;
                        const name = apiResponse.full_name;
                        const number = apiResponse.mobile_no;
                        const gender = apiResponse.gender;
                        const state = apiResponse.state_name;
                        const enrollmentNumber = loginid;
                        debugger
                        async function sigupIums() {

                            try {
                                class PasswordEncryptor {
                                    static _key = '9gcybtcn@';

                                    // Encrypt the password
                                    static encryptPassword(password) {
                                        const key = CryptoJS.enc.Utf8.parse(this._key.padEnd(32, '\0'));
                                        const encrypted = CryptoJS.AES.encrypt(password, key, { mode: CryptoJS.mode.ECB }).toString();
                                        return encrypted;
                                    }

                                    // Decrypt the password
                                    // static decryptPassword(encryptedPassword) {
                                    //   const key = CryptoJS.enc.Utf8.parse(this._key.padEnd(32, '\0'));
                                    //   const decrypted = CryptoJS.AES.decrypt(encryptedPassword, key, { mode: CryptoJS.mode.ECB }).toString(CryptoJS.enc.Utf8);
                                    //   return decrypted;
                                    // }
                                }
                                // Example Usage
                                let encryptedPassword = PasswordEncryptor.encryptPassword(password);
                                // console.log('Encrypted Password:', encryptedPassword);
                                // let decryptedPassword = PasswordEncryptor.decryptPassword(encryptedPassword);
                                // console.log('Decrypted Password:',decryptedPassword );  
                                // console.log(password)
                                // email = retrievedUserInfo.email;
                                // Get the button element
                                const setEmlpssBtn = document.getElementById('setEmlpss');

                                // Add click event listener
                                // Add click event listener
                                setEmlpssBtn.addEventListener('click', function () {
                                    // Store the predefined email and password in localStorage
                                    localStorage.setItem('predefined_email', email);
                                    localStorage.setItem('predefined_password', password);

                                    // Redirect to login
                                    window.location.href = 'login';
                                });
                                const userCredential = await createUserWithEmailAndPassword(
                                    auth,
                                    email,
                                    password
                                );

                                const userId = userCredential.user.uid;

                                function calculateNumericalUserUID(userId) {
                                    let hash = 0;
                                    for (let i = 0; i < userId.length; i++) {
                                        hash = (hash * 31) + userId.charCodeAt(i);
                                    }
                                    return Math.abs(hash) % 100000000000000;
                                }
                                let numericalUID = calculateNumericalUserUID(userId);
                                // Use the user's UID as the document ID when adding data to Firestore
                                const userDocRef = doc(db, "usersCollection", userId);
                                await setDoc(userDocRef, {
                                    name: name,
                                    email: email,
                                    password: encryptedPassword,
                                    phoneNumber: number,
                                    gender: gender,
                                    state: state,
                                    enrollmentNumber: enrollmentNumber,
                                    iumsStudent: true,
                                    phoneVerified: false,
                                    numericalUserUID: numericalUID,
                                    isWebAppRegisteration: true,
                                    // dateOfBirth: "",
                                    // college: "",
                                    // course: ""
                                });
                                localStorage.setItem("userId", userId);
                                // notify.show();
                                // notify(`User with ID ${userId} signed up successfully`);
                                // notify.innerHTML = `User with ID ${userId} signed up successfully`;
                                // event.preventDefault();
                                setTimeout(function () {
                                    $(".loader").hide();
                                    $(".text-signup").show();
                                }, 200);
                                checkUserAuthStatus();

                                debugger;
                                // Check if there's a URL stored for redirection
    const redirectUrl = localStorage.getItem('redirectAfterLogin');
    
    if (redirectUrl) {
      // Redirect to the intended URL
      window.location.href = redirectUrl;
      localStorage.removeItem('redirectAfterLogin'); // Clean up storage
    } else {
      // If no URL is stored, redirect to the homepage
      window.location.href = 'index';
    }
                                // clearInputFields();
                                // clearInputFields();
                            } catch (error) {
                                console.error("Error during sign-up:", error.message);
                                if (error.message == "Firebase: Error (auth/email-already-in-use).") {
                                    $('#mModal').modal('show');
                                    $("#eml").text(`The account already exist for ${email}. Please directly sign in.`);
                                    // $(".toast").toast('show');
                                    // Display toast message
                                    // $(".toast-body").text("Email already in use. Please enter a new email.");
                                    setTimeout(function () {
                                        $(".loader").hide();
                                        $(".text-signup").show();
                                    }, 200);
                                    document.querySelector("#loginid").focus();
                                    $(".same-email").show();
                                    // setTimeout(function () {
                                    //   $(".same-email").hide();
                                    // }, 3000);
                                    return
                                } else {
                                    $(".toast").toast('hide');
                                    $(".same-email").hide();
                                }
                                setTimeout(function () {
                                    $(".loader").hide();
                                    $(".text-signup").show();
                                }, 200);
                                // notify.show();
                                // notify(`Error: ${error.message}`);
                                // notify.innerHTML = `Error: ${error.message}`;
                            }
                        }
                        sigupIums()

                        // alert('Login successful');
                        // window.location.href = 'index'; // Redirect to the dashboard or another page
                    } else {
                        setTimeout(function () {
                            $(".loader").hide();
                            $(".text-signup").show();
                        }, 200);
                        $('#mModal').modal('show');
                        $("#mModalLabel").text(`Authentication Failed`);

                        $("#eml").text(`Please ensure that you email and password are correct, or sign up for a new account.`);
                        $("#signUpredirect").show();
                        $("#setEmlpss").hide();
                        //                     $(".toast").toast('show');
                        // $(".toast-body").text("Please check your college ID");
                        // Logic for failed login
                        // notify.show();
                        // notify('Login failed');
                        // setTimeout(() => {
                        //     notify.hide()
                        // }, 3000);
                        // alert('Login failed');
                    }
                }, error: function (xhr, status, error) {
                    console.error('AJAX error:', status, error);
                    //                 $(".toast").toast('show');
                    // $(".toast-body").text(status, error);
                    setTimeout(function () {
                        $(".loader").hide();
                        $(".text-signup").show();
                    }, 200);
                    // alert('An error occurred during login. Please try again.');
                },
            });
        }
        const signInBtn = document.querySelector('#signin');
        signInBtn.addEventListener('click', attemptLogin);

    </script>
    <script>
        $(document).ready(function () {
            $('#optInModal').modal('show');
        });
        function togglePasswordVisibility() {
            var passwordField = document.getElementById("password");
            var toggleEye = document.getElementById("togglePasswordVisibility");

            if (passwordField.type === "password") {
                passwordField.type = "text";
                toggleEye.className = "fa fa-eye position-absolute text-white"                // toggleButton.textContent = "Hide Password";
            } else {
                passwordField.type = "password";
                toggleEye.className = "fa fa-eye-slash position-absolute text-white"
            }
        }
        // import { auth } from "/js/firebase_auth.js";
        // console.log(auth)
        //     $(document).ready(function(){
        //    $('#myModal').modal('show');
        //     });
        //     document.cookie = "myCookie=myValue; SameSite=Lax";
        //     // var elements = document.querySelectorAll('.element');

        // setTimeout(function() {
        //     $('#myModal').modal('hide');
        // }, 5000);

    </script>
    <script src="./js/headerFooter.js" type="module"></script>

</body>

</html>